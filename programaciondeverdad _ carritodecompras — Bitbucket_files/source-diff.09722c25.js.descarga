!function(){function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3;n.register("2q8vl",(function(t,n){e(t.exports,"LOADING_MODULE_DELAY",(function(){return r}));const r=300})),n.register("jOyQ7",(function(r,a){e(r.exports,"default",(function(){return m}));var o=n("fPPqr"),i=n("9nHZC"),l=n("lIZwG"),s=n("agjvf"),c=n("EKmRU"),u=n("dEKDm"),d=n("1gNsY"),p=n("c7ndm");class m extends i.PureComponent{constructor(...e){super(...e),this.timeout=void 0,this.state={delay:this.props.delay}}componentDidMount(){const{delay:e}=this.state;e&&(this.timeout=setTimeout((()=>this.setState({delay:0})),e))}componentWillUnmount(){clearTimeout(this.timeout)}render(){const{delay:e}=this.state,{action:n,module:r,failedCallback:a}=this.props;if("loading"===n&&e)return!1;const m=(0,l.default)(r,"app_name",(0,l.default)(r,"app_key","")),f=(0,l.default)(r,"app_base_url",(0,l.default)(r,"source.url",""));return t(i).createElement(p.Container,null,"loading"===n&&t(i).createElement(p.Spinner,null,t(i).createElement(u.default,{size:"small",delay:0})),m&&f&&t(i).createElement(s.FormattedMessage,t(o)({},d.default[n],{values:{link:t(i).createElement("a",{href:f,target:"_blank"},m),action:"timeout"===n&&t(i).createElement(c.default,{appearance:"link",spacing:"none",onClick:a},t(i).createElement(s.FormattedMessage,d.default.cancelText))}})))}}m.defaultProps={action:"loading",delay:0}})),n.register("1gNsY",(function(t,r){e(t.exports,"default",(function(){return a}));var a=(0,n("agjvf").defineMessages)({loading:{id:"frontbucket.connect.loadingDescription",defaultMessage:"Loading app {link}."},timeout:{id:"frontbucket.connect.loadingTimeoutDescription",defaultMessage:"App {link} is not responding. Wait or {action}."},failed:{id:"frontbucket.connect.loadingFailedDescription",defaultMessage:"App {link} failed to load."},cancelText:{id:"frontbucket.connect.cancelText",defaultMessage:"cancel"}})})),n.register("c7ndm",(function(t,r){e(t.exports,"Container",(function(){return o})),e(t.exports,"Spinner",(function(){return i}));var a=n("2xJU3");const o=(0,a.default)("small",{target:"e1rsklf90"})({name:"1tbblij",styles:"position:absolute;left:0;top:0;right:0;bottom:0;display:flex;align-items:center;margin:0;padding:0 12px;"}),i=(0,a.default)("div",{target:"e1rsklf91"})({name:"ttjnck",styles:"margin:0 8px 0 0;"})})),n.register("9kkxk",(function(t,r){e(t.exports,"webPanelHeight",(function(){return l})),e(t.exports,"webPanelWidth",(function(){return s})),e(t.exports,"SourceWebPanel",(function(){return c})),e(t.exports,"PullRequestWebPanel",(function(){return u})),e(t.exports,"WebPanelHeader",(function(){return d})),e(t.exports,"WebPanelSection",(function(){return p}));var a=n("2xJU3"),o=n("aP6k3"),i=n("dCDrX");const l="50px",s="100%",c=(0,a.default)("div",{target:"evqr4d40"})("display:flex;position:relative;margin-bottom:",3*(0,o.gridSize)(),"px;min-height:",l,";max-height:280px;overflow:auto;iframe{display:block;}"),u=(0,a.default)("div",{target:"evqr4d41"})("display:flex;position:relative;margin-top:",(0,o.gridSize)(),"px;overflow:auto;min-height:",l,";max-height:600px;iframe{display:block;overflow:auto;}"),d=(0,a.default)("span",{target:"evqr4d42"})(i.h400(),";"),p=(0,a.default)("section",{target:"evqr4d43"})("margin-top:",(0,o.gridSize)(),"px;margin-bottom:",(0,o.gridSize)(),"px;")})),n.register("9q5oL",(function(t,r){e(t.exports,"isForgeEnabled",(function(){return o}));var a=n("hw8PW");const o=()=>(0,a.getFlagValue)(a.FeatureKeys.forge,!1)})),n.register("3F5vi",(function(t,r){e(t.exports,"ConnectSourceWebCards",(function(){return n("j1fGH").default})),e(t.exports,"ConnectPullRequestWebCards",(function(){return n("4dfKK").default}));n("j1fGH"),n("4dfKK")})),n.register("j1fGH",(function(r,a){e(r.exports,"default",(function(){return p}));var o=n("9nHZC"),i=n("lIZwG"),l=n("dGzLf"),s=n("bVIhs"),c=n("aanBq"),u=n("g2R3c"),d=n("ezxW3");var p=(0,l.connect)((e=>({principalId:(0,u.getTargetUserKey)(e),repository:(0,c.getCurrentRepository)(e),hash:(0,i.default)(e,"repository.source.section.hash"),sourceObject:e.repository.source.section.sourceObject})))((e=>{const{principalId:n,repository:r,hash:a,sourceObject:i,isCollapsed:l}=e;if(!n||!r||!i||i.isLoading)return null;const[c,u]=r.full_name.split("/"),{path:p,treeEntry:m}=i;return""===p?t(o).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source",isCollapsed:l,target:(0,s.repositoryTarget)({repositoryOwner:c,repositorySlug:u})}):p&&a&&m?"directory"===m.type?t(o).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source.directory",isCollapsed:l,target:(0,s.commitDirectoryTarget)({repositoryOwner:c,repositorySlug:u,path:`${p}/`,hash:a})}):t(o).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source.file",isCollapsed:l,target:(0,s.commitFileTarget)({repositoryOwner:c,repositorySlug:u,path:p,hash:a})}):null}))})),n.register("ezxW3",(function(r,a){e(r.exports,"WebCards",(function(){return f}));var o=n("fPPqr"),i=n("9nHZC"),l=n("lIZwG"),s=n("a7iuM"),c=n("6x4M3"),u=n("aUuqL"),d=n("dRi2h"),p=n("ks5r8"),m=n("4VBFd");class f extends i.PureComponent{render(){const{principalId:e,target:n,location:r,isCollapsed:a}=this.props;return t(i).createElement(c.ConnectIframes,{moduleType:"webCards",principalId:e,target:n,location:r,width:"100%",loadingComponent:()=>null,loadingFailedComponent:()=>null},(e=>e.length>0&&e.map((({Component:e,module:n})=>{const r=(0,l.default)(n,"descriptor.name.value"),c=t(i).createElement(d.default,{url:(0,l.default)(n,"descriptor.icon.url"),className:(0,l.default)(n,"descriptor.params.auiIcon")});return a?t(i).createElement(s.default,{key:n.id,position:"left",content:r},c):t(i).createElement(m.Card,{key:n.id,"data-qa":"connect-webcard"},t(i).createElement(u.ConnectedExpander,{defaultIsCollapsed:!0,localStorageKey:`${n.id}.card.collapsed`,icon:c,isLoading:!1,label:r,sectionAriaLabel:r},t(i).createElement(e,{loadingComponent:()=>t(i).createElement(p.default,{module:n,delay:300}),loadingTimeoutComponent:e=>t(i).createElement(p.default,t(o)({action:"timeout"},e,{module:n})),loadingFailedComponent:()=>t(i).createElement(p.default,{action:"failed",module:n})})))}))))}}})),n.register("dRi2h",(function(r,a){e(r.exports,"default",(function(){return c}));var o=n("2xJU3"),i=n("9nHZC");const l=(0,o.default)("span",{target:"e408k2m0"})({name:"96j35y",styles:"height:24px;width:24px;&::before{font-size:20px;margin-left:2px;margin-top:-10px;}"});class s extends i.PureComponent{render(){const{className:e,url:n}=this.props;if(n)return t(i).createElement("img",{src:n,alt:"",width:"24",height:"24"});const r=["aui-icon","aui-icon-large",e].join(" ").trim();return t(i).createElement(l,{className:r})}}var c=s})),n.register("ks5r8",(function(r,a){e(r.exports,"default",(function(){return m}));var o=n("fPPqr"),i=n("9nHZC"),l=n("lIZwG"),s=n("agjvf"),c=n("EKmRU"),u=n("dEKDm"),d=n("1gNsY"),p=n("dzmfC");class m extends i.PureComponent{constructor(...e){super(...e),this.timeout=void 0,this.state={delay:this.props.delay}}componentDidMount(){const{delay:e}=this.state;e&&(this.timeout=setTimeout((()=>this.setState({delay:0})),e))}componentWillUnmount(){clearTimeout(this.timeout)}render(){const{delay:e}=this.state,{action:n,module:r,failedCallback:a}=this.props;if("loading"===n&&e)return!1;const m=(0,l.default)(r,"app_name",(0,l.default)(r,"app_key","")),f=(0,l.default)(r,"app_base_url",(0,l.default)(r,"source.url",""));return t(i).createElement(p.Container,null,"loading"===n?t(i).createElement(p.Spinner,null,t(i).createElement(u.default,{size:"medium",delay:0})):m&&f&&t(i).createElement(s.FormattedMessage,t(o)({},d.default[n],{values:{link:t(i).createElement("a",{href:f,target:"_blank"},m),action:"timeout"===n&&t(i).createElement(c.default,{appearance:"link",spacing:"none",onClick:a},t(i).createElement(s.FormattedMessage,d.default.cancelText))}})))}}m.defaultProps={action:"loading",delay:0}})),n.register("dzmfC",(function(t,r){e(t.exports,"Container",(function(){return i})),e(t.exports,"Spinner",(function(){return l}));var a=n("2xJU3"),o=n("aP6k3");const i=(0,a.default)("small",{target:"ey323gi0"})({name:"rmxqah",styles:"display:flex;justify-content:center;align-items:center;margin:0;"}),l=(0,a.default)("div",{target:"ey323gi1"})("margin:",(0,o.gridSize)(),"px 0;")})),n.register("4VBFd",(function(t,r){e(t.exports,"Card",(function(){return i}));var a=n("2xJU3"),o=n("aP6k3");const i=(0,a.default)("div",{target:"ejd26n00"})("& + &{margin-top:",1.5*(0,o.gridSize)(),"px;}")})),n.register("4dfKK",(function(r,a){e(r.exports,"default",(function(){return d}));var o=n("9nHZC"),i=n("dGzLf"),l=n("1EkdU"),s=n("g2R3c"),c=n("ezxW3");class u extends o.PureComponent{render(){const{principalId:e,target:n,isCollapsed:r}=this.props;return e&&n?t(o).createElement(c.WebCards,{principalId:e,target:n,isCollapsed:r,location:"org.bitbucket.pullrequest"}):null}}var d=(0,i.connect)((e=>({principalId:(0,s.getTargetUserKey)(e),target:(0,l.getCurrentPullRequest)(e)})))(u)})),n.register("lum6u",(function(r,a){e(r.exports,"default",(function(){return p}));var o=n("9nHZC"),i=n("8zVyv"),l=n("hw8PW"),s=n("c5NwI"),c=n("7nLM4"),u=n("dYHhS");const d=({isPrPage:e})=>{const{component:n,createLink:r,isLoading:a}=(0,u.useCompassDetails)();if(a)return null;const l=t(o).createElement(i.CompassIcon,{label:"Compass"});if(!n)return r&&!e?t(o).createElement(c.Expander,{icon:l,label:"Compass"},t(o).createElement(s.Row,null,t(o).createElement("p",null,"To unlock a view of recent activity, scorecards, metrics and more, consider"," ",t(o).createElement("a",{href:r,target:"_blank"},"linking this repository to Compass.")))):null;const d=e?[]:n.links.filter((e=>"CHAT_CHANNEL"===e.type)),p=e?["ari:cloud:compass::metric-definition/builtin/pull-request-cycle-time-avg-last-10"]:[],m=n.metrics.filter((e=>p.includes(e.id))),f=e?null:n.team;return t(o).createElement(c.Expander,{icon:l,label:"Compass"},t(o).createElement(s.Row,null,t(o).createElement(s.Field,{label:"Component name",value:t(o).createElement("a",{href:n.url,target:"_blank"},n.name)})),f&&t(o).createElement(s.Row,null,t(o).createElement(s.Field,{label:"Owner",value:t(o).createElement("a",{href:f.url,target:"_blank"},f.name)})),d.length?t(o).createElement(s.Row,null,t(o).createElement(s.Field,{label:"Chat channels",value:d.map((e=>t(o).createElement("a",{key:e.id,href:e.url,target:"_blank"},e.name)))})):null,m.map((e=>e.value?t(o).createElement(s.Row,{key:e.name},t(o).createElement(s.Field,{label:e.name,value:e.value})):null)))};var p=e=>(0,l.useFeature)(l.FeatureKeys.showCompassCard,!1)?t(o).createElement(d,e):null})),n.register("8zVyv",(function(r,a){e(r.exports,"CompassIcon",(function(){return d}));var o=n("9nHZC"),i=n("4ul5V"),l=n("gb0Xp"),s=n("EMAbO"),c=n("k5A1i"),u=function(e){var t=e.appearance,n=e.iconGradientStart,r=e.iconGradientStop,a={iconGradientStart:n,iconGradientStop:r,iconColor:e.iconColor},o=(0,i.uid)({iconGradientStart:r});return t&&(a=(0,s.getColorsFromAppearance)(t)),'\n  <svg\n  fill="none"\n  height="32"\n  viewBox="0 0 32 32"\n  xmlns="http://www.w3.org/2000/svg"\n  focusable="false"\n  aria-hidden="true"\n>\n  <linearGradient\n    id="'.concat(o,'"\n    gradientUnits="userSpaceOnUse"\n    x1="20.8536"\n    x2="11.8744"\n    y1="11.2763"\n    y2="20.2556"\n  >\n    <stop offset="20%" stop-color="').concat(a.iconGradientStart,'" ').concat("inherit"===a.iconGradientStart?'stop-opacity="0.4"':"",' />\n    <stop offset="100%" stop-color="').concat(a.iconGradientStop,'" />\n  </linearGradient>\n  <path\n    d="m16.4644 15.6278v5.309h-5.2337v-5.309h5.2337v-5.3059h-9.54745c-.12228.0008-.24319.0259-.3557.0738-.1125.048-.21436.1178-.29966.2054-.08529.0876-.15233.1914-.1972.3051-.04487.1138-.0667.2353-.0642.3576v14.0653c-.0025.1223.01933.2438.0642.3576.04487.1137.11191.2175.1972.3051.0853.0876.18716.1574.29966.2054.11251.0479.23342.073.3557.0738h13.85185c.1223-.0008.2432-.0259.3557-.0738.1125-.048.2144-.1178.2997-.2054s.1523-.1914.1972-.3051c.0449-.1138.0667-.2353.0642-.3576v-9.7013z"\n    fill="url(#').concat(o,')"\n  />\n  <path\n    d="m16.4636 5.01256v5.30904h5.2463v5.3059h5.218v-9.68562c.0025-.12227-.0194-.24381-.0642-.35757-.0449-.11376-.1119-.21747-.1972-.3051s-.1872-.15744-.2997-.20537c-.1125-.04794-.2334-.07303-.3557-.07384z"\n    fill="').concat(a.iconGradientStop,'"\n  />\n</svg>')},d=function(e){var n=e.appearance,r=e.label,a=void 0===r?"Compass":r,i=e.size,s=void 0===i?l.defaultLogoParams.size:i,d=e.testId,p=e.iconColor,m=void 0===p?l.defaultLogoParams.iconColor:p,f=e.iconGradientStart,g=void 0===f?l.defaultLogoParams.iconGradientStart:f,h=e.iconGradientStop,y=void 0===h?l.defaultLogoParams.iconGradientStop:h,C=e.textColor,v=void 0===C?l.defaultLogoParams.textColor:C;return t(o).createElement(c.default,{appearance:n,label:a,svg:u({appearance:n,iconGradientStart:g,iconGradientStop:y,iconColor:m}),iconColor:m,iconGradientStart:g,iconGradientStop:y,size:s,testId:d,textColor:v})}})),n.register("dYHhS",(function(t,r){e(t.exports,"useCompassDetails",(function(){return l}));var a=n("9nHZC"),o=n("7hcP7"),i=n("iKOGB");const l=()=>{const[e,t]=(0,a.useState)(),[n,r]=(0,a.useState)(!1),[l,s]=(0,a.useState)(),[c]=(0,o.usePathParam)("repositoryOwner"),[u]=(0,o.usePathParam)("repositorySlug"),[d="master"]=(0,o.usePathParam)("refOrHash"),p=`${c}/${u}`;return(0,a.useEffect)((()=>{(async()=>{r(!0);try{const e=await(0,i.getComponentFromYaml)(p,d);if(e)return t(e),void r(!1)}catch(e){}try{const e=await(0,i.getComponentFromRepositoryLink)(p);if(e.component)return t(e.component),void r(!1);if(!e.cloudUrl)return void r(!1);r(!1),s(`${e.cloudUrl}/compass/components/services?showCreateComponentModal=true`)}catch(e){r(!1)}})()}),[]),{isLoading:n,component:e,createLink:l}}})),n.register("iKOGB",(function(t,r){e(t.exports,"getComponentFromYaml",(function(){return l})),e(t.exports,"getComponentFromRepositoryLink",(function(){return s}));var a=n("635SY"),o=n("k2cPS");const i=async(e,t)=>{let n;try{const r=await fetch(new Request("https://bitbucket.org/gateway/api/graphql",{method:"POST",headers:{...o.jsonHeaders,"X-ExperimentalApi":"compass-beta, compass-prototype"},body:JSON.stringify({query:"\n  query compass_components_searchComponents($cloudId: ID!, $componentAri: ID!) {\n    tenantContexts(cloudIds: [$cloudId]) {\n      hostName\n      cloudId\n      cloudUrl\n    }\n    compass {\n      component(id: $componentAri) {\n        ... on CompassComponent {\n          id\n          name\n          description\n          ownerId\n\n          metricSources {\n            ...on CompassComponentMetricSourcesConnection {\n              nodes {\n                metricDefinition {\n                  id\n                  name\n                  format{\n                    ... on CompassMetricDefinitionFormatSuffix {\n                      suffix\n                    }\n                  }}\n                  values {\n                    ... on CompassMetricSourceValuesConnection {\n                      nodes {\n                        value\n                      }\n                    }\n                  }\n              }\n            }\n          }\n\n          links {\n            id\n            name\n            url\n            type\n          }\n        }\n      }\n    }\n  }\n",operationName:"compass_components_searchComponents",variables:{cloudId:e,componentAri:t}}),credentials:"include"}));n=await r.json()}catch(e){return{}}const{data:{tenantContexts:[{cloudUrl:r}],compass:{component:{id:a,name:i,ownerId:l,links:s,metricSources:c}}}}=n,u=/ari:cloud:compass.*component\/.+\/(.+)/.exec(a);if(!u)return{cloudUrl:r};const d=c.nodes.map((e=>{const{metricDefinition:{id:t,name:n,format:{suffix:r}},values:{nodes:a}}=e;return{id:t,name:n,value:a.length?`${a[0].value} ${r}`:null}})),[,p]=u;return{component:{url:`${r}/compass/component/${p}`,name:i,ownerId:l,metrics:d,links:s},cloudUrl:r}},l=async(e,t)=>{const n=a.default.api.v20.source(e,t,"compass.yml");let r=null;try{const e=await fetch((0,o.default)(n),{headers:o.jsonHeaders});r=await e.text()}catch(e){return null}if(!r)return null;const l=/id:\s+"(ari:cloud:compass:(.+):component\/.+\/(.+))"/.exec(r);if(!l)return null;const[,s,c]=l;try{const e=await i(c,s);if(!e)return null;const{component:t,cloudUrl:n}=e;if(!t)return null;if(!n)return t;try{const e=await(async(e,t)=>{const n=/ari:cloud:teams::team\/(.+)/.exec(e);if(!n)return null;const[,r]=n;let a;try{const e=await fetch(new Request(`https://bitbucket.org/gateway/api/v3/teams/${r}`,{credentials:"include"}));a=await e.json()}catch(e){return null}return{name:a.displayName,url:`${t}/compass/people/team/${r}`}})(t.ownerId,n);return e?{...t,team:e}:t}catch(e){return t}}catch(e){return null}},s=async e=>{let t;try{if(t=await(async e=>{try{const t=(0,o.default)(`/!api/internal/repositories/${e}/jira/sites`),n=await fetch(t);return(await n.json()).values[0]}catch(e){return null}})(e),!t)return{}}catch(e){return{}}try{const{component:n}=await(async(e,t)=>{let n=null;try{const r=await fetch(new Request("https://bitbucket.org/gateway/api/graphql",{method:"POST",headers:{...o.jsonHeaders,"X-ExperimentalApi":"compass-beta, compass-prototype"},body:JSON.stringify({query:"\n  query compass_components_searchComponents($cloudId: String!, $query: CompassSearchComponentQuery) {\n    compass {\n      searchComponents(cloudId: $cloudId, query: $query) {\n        ... on CompassSearchComponentConnection {\n          nodes {\n            link\n            component {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n",variables:{cloudId:e,query:{fieldFilters:[{name:"links",filter:{eq:`https://bitbucket.org/${t}`}}]}},operationName:"compass_components_searchComponents"}),credentials:"include"}));n=await r.json()}catch(e){return{}}const r=n.data.compass.searchComponents.nodes;let a;if(r.length&&(a=r[0].component.id),!a)return{};try{const{component:t}=await i(e,a);if(t)return{component:t}}catch(e){return{}}return{}})(t.cloudId,e);return n?{component:n}:{cloudUrl:t.cloudUrl}}catch(e){return{}}}}))}();
//# sourceMappingURL=source-diff.09722c25.js.map
